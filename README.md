This shit is a mess, i will eventually separate it out into individual modules rather than all been in one python file.
